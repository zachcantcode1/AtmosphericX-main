<!DOCTYPE html>
<html>
    <title>AtmosphericX</title>
    <link rel="icon" href="/assets/media/dashboard/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="../../assets/styles/variables.css">
    <script src="../../assets/javascript/library.js"></script>
    <script src="../../assets/javascript/alerts.js"></script>
    <body>
        <p id="storm_report_text" class="text">Awaiting Callback...</p>
    </body>
    <script>
        let library = new Library()
        library.createWebsocketSession([`reports`]).then(() => {
            function renderReports() {
                let element = document.getElementById('storm_report_text');
                let reports = library.storage.reports || [];
                reports.sort((a, b) => new Date(b.issued) - new Date(a.issued));
                if (reports.length === 0) {
                    element.innerHTML = 'No storm reports available.';
                    return;
                }
                // Remove all line breaks from each description and format the output
                let alertHtml = reports.slice(0, 5)
                    .map(report => {
                        const type = report.event || '';
                        const location = report.location || '';
                        const details = (report.description || '').replace(/(\r\n|\n|\r)/gm, ' ');
                        return `<span class="alert-item"><span class="alert-type">${type}</span> â€” Location: ${location} | Details: ${details}</span>`;
                    })
                    .join('<span class="alert-separator">|</span>');
                element.innerHTML = alertHtml;
            }
            renderReports();
            document.addEventListener('onCacheUpdate', renderReports);
        });
    </script>
</html>
