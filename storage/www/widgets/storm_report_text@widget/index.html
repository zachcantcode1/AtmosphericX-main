<!DOCTYPE html>
<html>
    <title>AtmosphericX - Storm Report Text</title>
    <link rel="icon" href="/assets/media/dashboard/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="../../assets/styles/variables.css">
    <script src="../../assets/javascript/library.js"></script>
    <script src="../../assets/javascript/alerts.js"></script>
    <body>
        <div id="storm-reports-container" class="storm-reports-container">
            <!-- Storm reports will be injected here -->
        </div>
    </body>
    <script>
        let library = new Library()
        library.createWebsocketSession([`reports`]).then(() => {
            function renderReports() {
                const container = document.getElementById('storm-reports-container');
                container.innerHTML = '';
                let reports = library.storage.reports || [];
                reports.sort((a, b) => new Date(b.issued) - new Date(a.issued));
                reports.slice(0, 10).forEach(report => {
                    const div = document.createElement('div');
                    div.className = 'storm-report';
                    div.innerHTML = `<div class='report-title'><b>${report.event}</b> - <span class='report-location'>${report.location}</span></div>
                        <div class='report-time'><span>Issued: ${report.issued}</span></div>
                        <div class='report-description'>${report.description}</div>`;
                    container.appendChild(div);
                });
            }
            renderReports();
            document.addEventListener('onCacheUpdate', renderReports);
        });
    </script>
</html>
